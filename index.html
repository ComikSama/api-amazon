<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Scraping Amazon con JS puro</title>
  <style>
    table { border-collapse: collapse; width: 100%; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; }
    img { max-width: 100px; }
    input, button { padding: 0.5em; font-size: 1em; }
  </style>
</head>
<body>
  <h1>Scraping de Amazon</h1>
  <p>Ingresa la URL de búsqueda de Amazon y pulsa “Scrapear”.</p>
  <input id="url" type="text" size="60" placeholder="https://www.amazon.com/s?k=tu+producto…">
  <button id="go">Scrapear</button>

  <table id="results">
    <thead>
      <tr><th>Producto</th><th>Imagen</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    document.getElementById('go').addEventListener('click', async () => {
      const srcUrl = document.getElementById('url').value;
      if (!srcUrl) return alert('Pon una URL de búsqueda de Amazon primero.');

      // 1. Llamamos al proxy para sortear CORS
      const proxy = 'https://api.allorigins.win/raw?url=';
      const res = await fetch(proxy + encodeURIComponent(srcUrl));
      const html = await res.text();

      // 2. Lo convertimos en DOM
      const doc = new DOMParser().parseFromString(html, 'text/html');

      // 3. Buscamos cada resultado (selector usado puede cambiar con el diseño de Amazon)
      const items = doc.querySelectorAll('div.s-result-item[data-component-type="s-search-result"]');

      // 4. Preparamos la tabla
      const tbody = document.querySelector('#results tbody');
      tbody.innerHTML = '';

      // 5. Recorremos y extraemos nombre + URL de la imagen
      items.forEach(item => {
        const titleEl = item.querySelector('h2 a span');
        const imgEl   = item.querySelector('img.s-image');

        if (titleEl && imgEl) {
          const tr = document.createElement('tr');

          const tdTitle = document.createElement('td');
          tdTitle.textContent = titleEl.textContent.trim();

          const tdImg = document.createElement('td');
          const img = document.createElement('img');
          img.src = imgEl.src;
          img.alt = titleEl.textContent.trim();
          tdImg.appendChild(img);

          tr.appendChild(tdTitle);
          tr.appendChild(tdImg);
          tbody.appendChild(tr);
        }
      });
    });
  </script>
</body>
</html>
